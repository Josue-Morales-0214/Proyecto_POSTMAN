<div class="main-layout">
  
  <header class="navbar">
    <div class="brand">
      <span class="logo-icon"></span>
      <span class="logo-text">Postman Lite</span>
    </div>
    <button (click)="toggleHistory()" class="btn-icon" title="Historial">
      ğŸ•’
    </button>
  </header>

  <div class="container">

    <div class="request-card">
      <div class="input-wrapper">
        <div class="method-select-wrapper">
          <select [(ngModel)]="request().method" [class]="request().method">
            <option *ngFor="let m of methods" [value]="m">{{ m }}</option>
          </select>
        </div>
        
        <input type="text" [(ngModel)]="request().url" placeholder="https://api.ejemplo.com/usuarios" class="url-input">
        
        <button (click)="send()" [disabled]="isLoading()" class="btn-send">
          <span *ngIf="!isLoading()">ENVIAR</span>
          <span *ngIf="isLoading()" class="loader"></span>
        </button>
      </div>
    </div>

    <div class="tabs-container">
      <nav class="tabs-nav">
        <button [class.active]="activeTab() === 'params'" (click)="setActiveTab('params')" class="tab-link">ParÃ¡metros</button>
        <button [class.active]="activeTab() === 'headers'" (click)="setActiveTab('headers')" class="tab-link">Headers <span class="badge" *ngIf="request().headers.length > 0">{{request().headers.length}}</span></button>
        <button [class.active]="activeTab() === 'body'" (click)="setActiveTab('body')" [disabled]="!supportsBody" class="tab-link">Body JSON</button>
      </nav>

      <div class="tab-content">
        
        <div *ngIf="activeTab() === 'headers'" class="fade-in">
          <div *ngFor="let h of request().headers; let i = index" class="row-input">
            <input type="text" [(ngModel)]="h.key" placeholder="Key">
            <input type="text" [(ngModel)]="h.value" placeholder="Value">
            <button (click)="removeHeader(i)" class="btn-delete">Ã—</button>
          </div>
          <button (click)="addHeader()" class="btn-text">+ Agregar Header</button>
        </div>

        <div *ngIf="activeTab() === 'body' && supportsBody" class="fade-in">
          <textarea [(ngModel)]="request().body" class="code-editor" placeholder="{ ... }"></textarea>
        </div>
        
        <div *ngIf="activeTab() === 'params'" class="fade-in empty-msg">
          <small>Los parÃ¡metros de consulta (Query Params) se editan directamente en la URL por ahora.</small>
        </div>
      </div>
    </div>

    <div class="response-area" *ngIf="response() as res" #responseArea>
      <div class="response-header">
        <div class="status-pill" [ngClass]="getStatusColor(res.status)">
          {{ res.status }} {{ res.statusText }}
        </div>
        <div class="metrics">
          <span>â± {{ res.time }}ms</span>
          <span>ğŸ“¦ {{ res.size }}</span>
        </div>
      </div>
      
      <div class="code-block">
         <pre [innerHTML]="formatJson(res.data)"></pre>
      </div>
    </div>

    <div *ngIf="!response() && !isLoading()" class="empty-state">
      <div class="illustration">ğŸš€</div>
      <p>Listo para lanzar tu peticiÃ³n</p>
    </div>

  </div>

  <div class="history-sidebar" [class.open]="showHistory()">
    <div class="sidebar-header">
      <h3>Historial</h3>
      <button (click)="toggleHistory()">âœ•</button>
    </div>
    <div class="history-list">
      <div *ngFor="let item of history()" (click)="loadFromHistory(item)" class="history-item">
        <span class="method-tag tiny" [class]="item.method">{{ item.method }}</span>
        <span class="url-truncate">{{ item.url }}</span>
      </div>
    </div>
    <div class="sidebar-footer">
      <button (click)="clearHistory()">Borrar todo</button>
    </div>
  </div>

  <div class="overlay" *ngIf="showHistory()" (click)="toggleHistory()"></div>
</div>